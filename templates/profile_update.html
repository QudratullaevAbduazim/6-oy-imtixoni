{% extends 'base.html' %}

{% block title %}Profil - Moliya Tizimi{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>ðŸ‘¤ Mening profilim</h2>
        <p>Shaxsiy ma'lumotlaringizni yangilang</p>
    </div>

    {% if user.profile.profile_picture %}
        <img src="{{ user.profile.profile_picture.url }}" alt="Profil rasmi" class="profile-image-preview" id="imagePreview">
    {% else %}
        <img src="https://via.placeholder.com/150?text=ðŸ‘¤" alt="Profil rasmi" class="profile-image-preview" id="imagePreview">
    {% endif %}

    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.bio.id_for_label }}">
                {{ form.bio.label }}
            </label>
            {{ form.bio }}
            {% if form.bio.help_text %}
                <small class="form-text">{{ form.bio.help_text }}</small>
            {% endif %}
            {% if form.bio.errors %}
                <ul class="errorlist">
                    {% for error in form.bio.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.phone_number.id_for_label }}">
                {{ form.phone_number.label }}
            </label>
            {{ form.phone_number }}
            {% if form.phone_number.help_text %}
                <small class="form-text">{{ form.phone_number.help_text }}</small>
            {% endif %}
            {% if form.phone_number.errors %}
                <ul class="errorlist">
                    {% for error in form.phone_number.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.birth_date.id_for_label }}">
                {{ form.birth_date.label }}
            </label>
            {{ form.birth_date }}
            {% if form.birth_date.help_text %}
                <small class="form-text">{{ form.birth_date.help_text }}</small>
            {% endif %}
            {% if form.birth_date.errors %}
                <ul class="errorlist">
                    {% for error in form.birth_date.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.profile_picture.id_for_label }}">
                {{ form.profile_picture.label }}
            </label>
            {{ form.profile_picture }}
            {% if form.profile_picture.help_text %}
                <small class="form-text">{{ form.profile_picture.help_text }}</small>
            {% endif %}
            {% if form.profile_picture.errors %}
                <ul class="errorlist">
                    {% for error in form.profile_picture.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        {% if form.non_field_errors %}
            <div class="alert alert-error">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
        {% endif %}

        <button type="submit" class="btn btn-primary">
            Saqlash
        </button>

        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
            Bekor qilish
        </a>
    </form>
</div>

<script>
    // Rasm tanlanganda preview ko'rsatish
    document.getElementById('{{ form.profile_picture.id_for_label }}').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}